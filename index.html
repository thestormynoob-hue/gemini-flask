<!DOCTYPE html>
<html>
<head>
  <title>Gemini Web Client</title>
</head>
<body>
  <h2>Gemini Web Demo</h2>
  <textarea id="prompt" rows="5" cols="50" placeholder="Type your question..."></textarea><br>
  <button onclick="callGemini()">Send</button>
  <pre id="response"></pre>

<script>
  const API_KEY = "AIzaSyABQHobyJo2wEqHaYJp-5WoD0cwjHlw04Q"; // your Gemini API key

  // لیست تاریخچه مکالمه
  let history = [];

  async function callGemini() {
    const prompt = document.getElementById("prompt").value;
    document.getElementById("response").innerText = "Loading...";

    // اضافه کردن پیام کاربر به تاریخچه
    history.push({ role: "user", parts: [{ text: prompt }] });

    try {
      const response = await fetch(
        "https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=" + API_KEY,
        {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ contents: history })
        }
      );

      const data = await response.json();
      console.log("Gemini response:", data);

      if (data.candidates &&
          data.candidates.length > 0 &&
          data.candidates[0].content.parts.length > 0 &&
          data.candidates[0].content.parts[0].text) {
        
        const reply = data.candidates[0].content.parts[0].text;

        // اضافه کردن پاسخ مدل به تاریخچه
        history.push({ role: "model", parts: [{ text: reply }] });

        document.getElementById("response").innerText =
          reply;
      } else if (data.error) {
        document.getElementById("response").innerText =
          "Error: " + data.error.message;
      } else {
        document.getElementById("response").innerText =
          "Unexpected response:\n" + JSON.stringify(data, null, 2);
      }
    } catch (e) {
      document.getElementById("response").innerText =
        "Fetch error: " + e;
    }
  }
</script>

</body>
</html>
